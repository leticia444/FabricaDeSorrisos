@model FabricaDeSorrisos.Web.Models.ProdutoDetalhesViewModel
@{
    ViewData["Title"] = Model.Produto.Nome;
}

<nav aria-label="breadcrumb" class="py-3 bg-light mb-4 border-bottom">
    <div class="container">
        <ol class="breadcrumb mb-0 small fw-bold">
            <li class="breadcrumb-item"><a asp-action="Index" class="text-decoration-none text-muted">Home</a></li>
            <li class="breadcrumb-item"><a asp-action="Busca" asp-route-termoBusca="@Model.Produto.Categoria" class="text-decoration-none text-muted">@Model.Produto.Categoria</a></li>
            <li class="breadcrumb-item active text-primary" aria-current="page">@Model.Produto.Nome</li>
        </ol>
    </div>
</nav>

<div class="container">
    <div class="row g-5">

        <div class="col-md-6">
            <div class="bg-white p-5 rounded-5 shadow-sm border position-relative text-center overflow-hidden">
                <img src="@(Model.Produto.ImagemUrl ?? "https://placehold.co/500?text=Sem+Foto")"
                     class="img-fluid zoom-effect"
                     alt="@Model.Produto.Nome"
                     style="max-height: 400px; object-fit: contain;">

                <span class="position-absolute top-0 start-0 m-4 badge bg-secondary bg-opacity-10 text-secondary border border-secondary border-opacity-25 rounded-pill px-3 py-2">
                    @Model.Produto.Marca
                </span>
            </div>
        </div>

        <div class="col-md-6">
            <h5 class="text-muted text-uppercase small fw-bold mb-2">@ViewBag.SubCategoria</h5>
            <h1 class="fw-bold mb-3 display-6" style="color: #333;">@Model.Produto.Nome</h1>

            <div class="mb-3 text-warning">
                <i class="bi bi-star-fill"></i>
                <i class="bi bi-star-fill"></i>
                <i class="bi bi-star-fill"></i>
                <i class="bi bi-star-fill"></i>
                <i class="bi bi-star-half"></i>
                <span class="text-muted small ms-2 text-dark">(42 avaliações)</span>
            </div>

            <div class="mb-4">
                <h2 class="display-4 fw-bold text-primary mb-0">R$ @Model.Produto.Preco.ToString("N2")</h2>
                <span class="text-muted fs-5">em até <strong>6x de R$ @((Model.Produto.Preco / 6).ToString("N2"))</strong> sem juros</span>
            </div>

            @if (Model.Produto.Estoque > 0)
            {
                <div class="alert alert-success d-inline-block py-2 px-3 rounded-3 mb-4 border-0 bg-success bg-opacity-10 text-success fw-bold">
                    <i class="bi bi-check-circle-fill me-2"></i> Estoque disponível (@Model.Produto.Estoque un.)
                </div>
            }
            else
            {
                <div class="alert alert-danger d-inline-block py-2 px-3 rounded-3 mb-4">
                    <i class="bi bi-x-circle-fill me-2"></i> Produto Esgotado
                </div>
            }

            <div class="d-flex gap-3 mb-5">
                @if (Model.Produto.Estoque > 0)
                {
                    <button class="btn btn-success btn-lg rounded-pill px-5 fw-bold flex-grow-1 shadow hover-scale"
                            onclick="adicionarAoCarrinho(this, @Model.Produto.Id)">
                        <i class="bi bi-bag-plus-fill me-2"></i> ADICIONAR À SACOLA
                    </button>
                }
                else
                {
                    <button class="btn btn-secondary btn-lg rounded-pill px-5 fw-bold flex-grow-1 disabled">
                        AVISE-ME QUANDO CHEGAR
                    </button>
                }

                <button class="btn btn-outline-danger btn-lg rounded-circle"
                        onclick="toggleFavorito(this, @Model.Produto.Id)"
                        data-auth="@User.Identity.IsAuthenticated.ToString().ToLower()"
                        title="Adicionar aos Favoritos">
                    <i class="bi bi-heart"></i>
                </button>
            </div>

            <div class="card border-0 bg-light rounded-4 mb-4">
                <div class="card-body p-3">
                    <div class="d-flex align-items-center gap-3 mb-3">
                        <div class="bg-white p-2 rounded-circle text-primary"><i class="bi bi-truck fs-4"></i></div>
                        <div>
                            <h6 class="fw-bold mb-0">Frete Grátis</h6>
                            <small class="text-muted">Para compras acima de R$ 299,00</small>
                        </div>
                    </div>
                    <div class="d-flex align-items-center gap-3">
                        <div class="bg-white p-2 rounded-circle text-success"><i class="bi bi-shield-check fs-4"></i></div>
                        <div>
                            <h6 class="fw-bold mb-0">Compra Garantida</h6>
                            <small class="text-muted">Receba o produto ou seu dinheiro de volta</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-5">
        <div class="col-12">
            <ul class="nav nav-pills mb-4 gap-3 justify-content-center" id="pills-tab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active rounded-pill px-4 border" id="pills-desc-tab" data-bs-toggle="pill" data-bs-target="#pills-desc" type="button" role="tab">Descrição</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link rounded-pill px-4 border" id="pills-specs-tab" data-bs-toggle="pill" data-bs-target="#pills-specs" type="button" role="tab">Características</button>
                </li>
            </ul>
            <div class="tab-content" id="pills-tabContent">
                <div class="tab-pane fade show active" id="pills-desc" role="tabpanel">
                    <div class="bg-white p-5 rounded-4 border text-secondary lh-lg">
                        <h4 class="fw-bold text-dark mb-3">Sobre o Produto</h4>
                        <p>@Model.Produto.Descricao</p>
                        <p>Ideal para estimular a criatividade e proporcionar horas de diversão. Fabricado com materiais de alta qualidade e segurança certificada.</p>
                    </div>
                </div>
                <div class="tab-pane fade" id="pills-specs" role="tabpanel">
                    <div class="bg-white p-5 rounded-4 border">
                        <h4 class="fw-bold text-dark mb-3">Ficha Técnica</h4>
                        <table class="table table-borderless">
                            <tbody>
                                <tr class="border-bottom">
                                    <td class="text-muted w-25">Marca</td>
                                    <td class="fw-bold">@Model.Produto.Marca</td>
                                </tr>
                                <tr class="border-bottom">
                                    <td class="text-muted">Faixa Etária</td>
                                    <td class="fw-bold">@ViewBag.FaixaEtaria</td>
                                </tr>
                                <tr class="border-bottom">
                                    <td class="text-muted">Personagem</td>
                                    <td class="fw-bold">@(ViewBag.Personagem ?? "Nenhum")</td>
                                </tr>
                                <tr class="border-bottom">
                                    <td class="text-muted">Categoria</td>
                                    <td class="fw-bold">@Model.Produto.Categoria</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @if (Model.Relacionados.Any())
    {
        <div class="mt-5 pt-4 border-top">
            <h3 class="fw-bold mb-4 text-center">Quem viu, também gostou 🧸</h3>
            <div class="row row-cols-1 row-cols-md-4 g-4">
                @foreach (var item in Model.Relacionados)
                {
                    <div class="col">
                        <div class="card h-100 shadow-sm border-0 hover-card rounded-4 overflow-hidden">
                            <a asp-action="Detalhes" asp-route-id="@item.Id" class="text-decoration-none text-dark">
                                <div class="text-center p-4 bg-light position-relative">
                                    <img src="@(item.ImagemUrl ?? "https://placehold.co/200?text=Foto")"
                                         class="img-fluid" style="height: 150px; object-fit: contain;">
                                </div>
                                <div class="card-body text-center">
                                    <h6 class="card-title fw-bold text-truncate">@item.Nome</h6>
                                    <h5 class="fw-bold text-primary">R$ @item.Preco.ToString("N2")</h5>
                                    <small class="text-muted">Ver detalhes</small>
                                </div>
                            </a>
                        </div>
                    </div>
                }
            </div>
        </div>
    }

</div>

<style>
    .zoom-effect {
        transition: transform 0.5s ease;
        cursor: zoom-in;
    }
    .zoom-effect:hover {
        transform: scale(1.1);
    }
    .nav-pills .nav-link.active {
        background-color: #00bfff; /* Azul Fábrica */
    }
    .nav-pills .nav-link {
        color: #555;
    }
</style>
